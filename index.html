<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js"></script>

<!-- <img src="cd.gif"> -->
<!-- <body></body> -->

<script>
/* global nn */
  
  let time = 0
  let fires = []
  let fire2
  let canvas
  let ctx
  let size = 30
  
  let dests = [
    [0, 0], 
    [0, nn.height], 
    [nn.width, 0], 
    [nn.width, nn.height],
    [nn.width / 2, nn.height / 2],
    [0, nn.height / 2], 
    [nn.width / 2, 0], 
    [nn.width / 2, nn.height],
    [nn.width, nn.height / 2]
  ]
  
  function drawLine(x1, y1, x2, y2) {
    ctx.strokeStyle = 'white'
    ctx.beginPath()
    ctx.moveTo(x1, y1)
    ctx.lineTo(x2, y2)
    ctx.stroke()
    ctx.closePath()
  }
  
  function createFire(size, x, y) {
    const img = nn.create('img')
      .set({ 
        src: 'fire_bg.gif', 
        alt: 'fire gif' 
      })
      .css({
        'width': `${size}`,
        'position': 'absolute',
        'left': `${x}px`,
        'top': `${y}px`
      })
      .addTo('body');
    
    return img
  }
  
  function createFireCircle(scale, r, cx, cy) {
    for (let i = 0; i < Math.PI * scale * 2; i++) {
      let x = cx + Math.cos(i * 1/scale) * r;
      let y = cy + Math.sin(i * 1/scale) * r;
      x = x - size / 2;
      y = y - size / 2;
      
      let img = createFire(size, x, y);
      fires.push({ img, x, y });
    }
  }
  
  function moveFireCircle() {
    for (let i = 0; i < fires.length; i++) {
      let fire = fires[i]
      fire.x = fire.x + Math.cos(time) * 2
      fire.y = fire.y + Math.sin(time) * 2
      
      for (let j = 0; j < dests.length; j++) {
        drawLine(fire.x + size / 2, fire.y + size / 2, dests[j][0], dests[j][1])
      }
      
      
      fire.img.css({ left: `${fire.x}px`, top: `${fire.y}px` })
    }
  }
  
  function setup() {
    nn.get('body').css({ margin: '0', height: '100vh' })
    canvas = nn.create('canvas').addTo('body')
    canvas.width = nn.width
    canvas.height = nn.height
    ctx = canvas.getContext('2d')
    
    createFireCircle(5, 100, nn.width / 2, nn.height / 4);
    
    for (let i = 0; i < dests.length; i++) {
      createFire(size, dests[i][0], dests[i][1])
    }
    
    // fire2 = createFire(25, nn.width / 2, nn.height / 2);
  }
  
  function draw () {
    requestAnimationFrame(draw)
    ctx.fillRect(0, 0, nn.width, nn.height)
    
    moveFireCircle(time);
    
    // fire2.css({ left: `${0}px`, top: `${0}px` })
    time += 0.01
  }
  
  nn.on('load', setup)
  nn.on('load', draw)
  
</script>